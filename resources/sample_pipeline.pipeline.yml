resources:
  pipelines:  # https://docs.databricks.com/aws/en/dev-tools/bundles/resources#pipeline
    sample_pipeline:
      name: Sample ETL Pipeline
      edition: ADVANCED
      channel: CURRENT

      catalog: ${var.catalog_name}
      # Shared default; bundle targets override schema when needed
      schema: ${var.default_schema_name}
      photon: ${var.photon_enabled}
      continuous: ${var.continuous_mode}

      # Specify the FQN for the pipeline event logs table
      event_log:
        catalog: ${var.catalog_name}
        schema: ${var.default_schema_name}
        name: pipeline_event_log

      # DLT configuration passed to notebooks
      configuration:
        "spark.databricks.delta.autoCompact.enabled": "true"
        "spark.databricks.delta.optimizeWrite.enabled": "true"
        "catalogName": ${var.catalog_name}
        "pipelineEnvironment": ${bundle.target}
        "userName": ${workspace.current_user.short_name}

      # OPTION 1: Serverless compute
      serverless: true

      # OPTION 2: Custom cluster for DLT
      # Uncomment the section below and set serverless: false
      # Template source: templates/cluster_configs.yml (pipeline_cluster_autoscale)
      # clusters:
      #   - label: default
      #     node_type_id: Standard_DS3_v2  # AWS: i3.xlarge; Azure: Standard_DS3_v2; GCP: n1-highmem-4
      #     autoscale:
      #       mode: ENHANCED
      #       min_workers: ${var.pipeline_min_workers}
      #       max_workers: ${var.pipeline_max_workers}
      #     custom_tags:
      #       bundle: ${bundle.name}
      #       environment: ${bundle.target}

      # Python dependencies for the pipeline
      # Add any PyPI packages your pipeline code needs
      # Docs: https://docs.databricks.com/aws/en/dev-tools/bundles/resources#pipelineenvironment
      # environment:
      #   dependencies:
      #     - requests==2.32.3
      #     - simplejson==3.19.2

      # Source code - referencing *.py files in Databricks Notebook format
      libraries:
        - notebook:
            path: ${workspace.file_path}/src/pipelines/bronze
        - notebook:
            path: ${workspace.file_path}/src/pipelines/silver

